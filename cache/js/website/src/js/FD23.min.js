function d(){return window.performance&&window.performance.now?window.performance.now():Date.now()}function f(e){var t=e.getBoundingClientRect();return t.top+t.height>=0&&t.left+t.width>=0&&t.bottom-t.height<=(window.innerHeight||document.documentElement.clientHeight)&&t.right-t.width<=(window.innerWidth||document.documentElement.clientWidth)}export default function _(e,t){if(typeof e=="string"&&(e=document.getElementById(e)),e.tagName!="CANVAS")return console.error("Target must be a canvas"),null;this._target=e;function i(a,h){return typeof a<"u"?a:h}return typeof t=="string"?t=JSON.parse(t):typeof t>"u"&&(t={}),this.targetHue=i(t.targetHue,120),this.targetSaturation=i(t.targetSaturation,75),t.targetSaturation,this.targetLightness=i(t.targetLightness,16),this.targetAlpha=i(t.targetAlpha,40),this.targetHueVariance=i(t.targetHueVariance,43),this.targetSaturationVariance=i(t.targetSaturationVariance,0),this.targetLightnessVariance=i(t.targetLightnessVariance,0),this.colorAdjustmentSpeed=i(t.colorAdjustmentSpeed,1),this.hueCyclePeriod=i(t.hueCyclePeriod,0),this.compensatePerceivedBrightness=i(t.compensatePerceivedBrightness,!1),this.nParticles=i(t.nParticles,5),this.ringsPerParticle=i(t.ringsPerParticle,2),this.targetGradientBias=i(t.targetGradientBias,.85),this.targetRingDistortionIntensity=i(t.targetRingDistortionIntensity,1),this.targetSpeedNormal=i(t.targetSpeedNormal,1),this.targetSpeedLoading=i(t.targetSpeedLoading,25),this.targetSpeed=this.targetSpeedNormal,this.targetAnimationIntensity=i(t.targetAnimationIntensity,1),this.speedAdjustmentSpeed=i(t.speedAdjustmentSpeed,1),this.followPageScroll=i(t.followPageScroll,!0),this.targetTOffset=0,this.tOffsetIntensity=i(t.tOffsetIntensity,3),this.tOffsetAdjustmentSpeed=i(t.tOffsetAdjustmentSpeed,1),this.resolutionScale=i(t.resolutionScale,1),this.maxFps=i(t.maxFps,0),this.paused=!1,this._hue=this.targetHue,this._saturation=this.targetSaturation,this._lightness=this.targetLightness,this._alpha=this.targetAlpha,this._hueVariance=this.targetHueVariance,this._saturationVariance=this.targetSaturationVariance,this._lightnessVariance=this.targetLightnessVariance,this._gradientBias=this.targetGradientBias,this._ringDistortionIntensity=this.targetRingDistortionIntensity,this._speed=this.targetSpeed,this._animationIntensity=this.targetAnimationIntensity,this._ts=d(),this._prevTs=0,this._t=Date.now(),this._tOffset=0,this._scrollCompensation=0,requestAnimationFrame(this._draw.bind(this)),this}_.prototype={constructor:_,_draw:function(){if(!this.paused&&f(this._target)&&(this.maxFps==0||d()+1>=this._prevTs+1e3/this.maxFps)){this._ts=d();var e=this._target;(this._prevW!=e.clientWidth||this._prevH!=e.clientHeight||this.resolutionScale!=this._prevResolutionScale)&&(e.width=(e.clientWidth<10?10:e.clientWidth)*this.resolutionScale*(window.devicePixelRatio||1),e.height=(e.clientHeight<10?10:e.clientHeight)*this.resolutionScale*(window.devicePixelRatio||1),e.style.width="100dvw",e.style.height="100dvh",this._prevResolutionScale=this.resolutionScale),this.followPageScroll&&(this.targetTOffset=this._scrollCompensation+(this._loading?0:window.pageYOffset)),this._ts-this._prevTs>1e3&&(this._prevTs=this._ts-30),this._t+=(this._ts-this._prevTs)*this._speed,this._tOffset-=(this._ts-this._prevTs)*.003*this.tOffsetAdjustmentSpeed*(this._tOffset-this.targetTOffset);var t=(this._t+this._tOffset*this.tOffsetIntensity)*3e-5;this._hue-=(this._ts-this._prevTs)*.003*this.colorAdjustmentSpeed*(this._hue-this.targetHue);var i=this._hue;this.hueCyclePeriod>0&&(i+=Date.now()/this.hueCyclePeriod%360),this._saturation-=(this._ts-this._prevTs)*.003*this.colorAdjustmentSpeed*(this._saturation-this.targetSaturation),this._lightness-=(this._ts-this._prevTs)*.003*this.colorAdjustmentSpeed*(this._lightness-this.targetLightness);var a=this._lightness;this.compensatePerceivedBrightness&&(a*=.6+.4*(.5*(Math.cos(2*Math.PI*i/360+Math.PI/2)+1))),this._alpha-=(this._ts-this._prevTs)*.003*this.colorAdjustmentSpeed*(this._alpha-this.targetAlpha),this._hueVariance-=(this._ts-this._prevTs)*.002*this.colorAdjustmentSpeed*(this._hueVariance-this.targetHueVariance),this._saturationVariance-=(this._ts-this._prevTs)*.002*this.colorAdjustmentSpeed*(this._saturationVariance-this.targetSaturationVariance),this._lightnessVariance-=(this._ts-this._prevTs)*.002*this.colorAdjustmentSpeed*(this._lightnessVariance-this.targetLightnessVariance),this._speed-=(this._ts-this._prevTs)*.0025*this.speedAdjustmentSpeed*(this._speed-this.targetSpeed),this._gradientBias-=(this._ts-this._prevTs)*.0025*this.speedAdjustmentSpeed*(this._gradientBias-this.targetGradientBias),this._animationIntensity-=(this._ts-this._prevTs)*.0015*this.speedAdjustmentSpeed*(this._animationIntensity-this.targetAnimationIntensity),this._ringDistortionIntensity-=(this._ts-this._prevTs)*.0025*this.speedAdjustmentSpeed*(this._ringDistortionIntensity-this.targetRingDistortionIntensity);var h=e.getContext("2d");h.globalCompositeOperation="source-over",h.fillStyle="hsl("+i+","+this._saturation+"%,"+a*.25+"%)",h.fillRect(0,0,e.width,e.height);var u=e.width/2,m=e.height/2,r=Math.max(e.width,e.height)*.35;h.globalCompositeOperation="screen";for(var s=0;s<this.nParticles;s++){var p=u+r*Math.cos(t+2*Math.PI*s/this.nParticles)+.3*r*this._animationIntensity*(Math.sin(t*1.345864+s)+Math.sin(t*2.789721+s)),g=m+r*Math.sin(t+2*Math.PI*s/this.nParticles)+.3*r*this._animationIntensity*(Math.sin(t*1.796842+s)+Math.sin(t*2.374546+s)),S=p+.15*this._ringDistortionIntensity*r*(Math.sin(t*4.246215+s)+Math.sin(t*5.789871+s)),c=g+.15*this._ringDistortionIntensity*r*(Math.sin(t*3.046215+s)+Math.sin(t*4.219871+s)),o=h.createRadialGradient(p,g,0,S,c,r*2),n="hsla(";n+=i+s*this._hueVariance/this.nParticles*(s%2==0?1:-1)+",",n+=this._saturation+s*this._saturationVariance/this.nParticles*(s%2==0?1:-1)+"%,",n+=a+s*this._lightnessVariance/this.nParticles*(s%2==0?1:-1)+"%,",n+=this._alpha+"%)";for(var l=0;l<this.ringsPerParticle;l++)o.addColorStop(Math.pow(2*l/(this.ringsPerParticle*2),this._gradientBias),"#00000000"),o.addColorStop(Math.pow((2*l+1)/(this.ringsPerParticle*2),this._gradientBias),n);o.addColorStop(1,"#00000000"),h.fillStyle=o,h.fillRect(0,0,e.width,e.height)}h.globalCompositeOperation="source-over",this._prevW=e.clientWidth,this._prevH=e.clientHeight,this._prevTs=this._ts}requestAnimationFrame(this._draw.bind(this))},loadStart:function(){this._scrollCompensation+=window.pageYOffset,this._loading=!0,this.targetSpeed=this.targetSpeedLoading},loadDone:function(){this._loading=!1,this.targetSpeed=this.targetSpeedNormal}};
